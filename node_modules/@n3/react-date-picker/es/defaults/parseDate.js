import parse from 'date-fns/parse';
import isValid from 'date-fns/isValid';
import locales from "../locales";

var parseDate = function parseDate(date, locale) {
  var referenceDate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Date();
  var match = date.match(/(.)(\d{1,4})$/);
  var isSetFullYear = false;

  if (match) {
    var separator = match[1];
    var year = match[2];
    isSetFullYear = !!separator && date.split(separator).length === 3 && year.length === 3;
  }

  var dateStrWithFullYear = isSetFullYear ? "".concat(date, "0") : date;
  var _locales$locale = locales[locale],
      formats = _locales$locale.formats,
      dateFnsLocale = _locales$locale.dateFnsLocale;

  for (var i = 0, l = formats.length; i < l; ++i) {
    var format = formats[i];
    var parsed = parse(dateStrWithFullYear, format, referenceDate, {
      locale: dateFnsLocale
    });

    if (isValid(parsed)) {
      return parsed;
    }
  }

  return null;
};

export default parseDate;