import fs from 'fs';
import { transformWithEsbuild } from 'vite';
export default function viteSvgr({ exportAsDefault, svgrOptions, esbuildOptions, } = {}) {
    return {
        name: 'vite-plugin-svgr',
        async transform(code, id) {
            if (id.endsWith('.svg')) {
                const { transform } = await import('@svgr/core');
                const svgCode = await fs.promises.readFile(id, 'utf8');
                const componentCode = await transform(svgCode, svgrOptions, {
                    filePath: id,
                    caller: {
                        previousExport: exportAsDefault ? null : code,
                    },
                });
                const res = await transformWithEsbuild(componentCode, id, Object.assign({ loader: 'jsx' }, esbuildOptions));
                return {
                    code: res.code,
                    map: null, // TODO:
                };
            }
        },
    };
}
